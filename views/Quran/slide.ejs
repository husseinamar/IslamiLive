<html>
    <head>
        <meta http-equiv="content-Type" content="text/html; utf-8" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="../../public/js/textFit.js"></script>
        <style>
            @font-face {
                font-family: 'me-quran';
                src: URL('../../public/fonts/me_quran.ttf');
            }

            * {
                box-sizing: border-box;
            }

            html, body {
                padding: 0!important;
                margin: 0!important;
                width: 1920px!important;
                height: 1080px!important;
            }

            div.slide {
                position: relative;
                left: 0;
                top: 0;
                width: 1922px;
                height: 1080px;
                padding: 0!important;
                margin: 0!important;
                background-image: url("<%= assets.background.src %>");
                background-position: -1 1;
                background-repeat: no-repeat;
                background-size: 1924px 1086px;
                overflow: hidden;
            }

            div.slide.light {
                background-image: url("<%= assets.backgroundLight.src %>");
            }

            .ribbon {
                position: absolute;
                width: 1922px;
                height: 64px;
                bottom: 0px;
                background-position: center;
                background-image: url("<%= assets.ribbon.src %>");
                background-repeat: no-repeat;
                background-size: 1922px 100px;
            }

            .title {
                display: flex;
                justify-content: center;
                align-items: center;
                text-align: center;

                font-family: 'me-quran';
                word-spacing: 10;
                word-wrap: break-word;
                overflow-wrap: break-word;
                padding: 10px;

                position: absolute;
                width: 345px;
                left: 150px;
                height: 75px;
                top: 25px
            }

            .lantern {
                --width: <%= assets.lantern.width %>px;
                --height: <%= assets.lantern.height %>px;
                background-image: url("<%= assets.lantern.src %>");
                background-repeat: no-repeat;
                background-size: calc(var(--width) * 0.8) calc(var(--height) * 0.8);
                width: calc(var(--width) * 0.8);
                height: calc(var(--height) * 0.8);
                position: absolute;
            }

            .small .lantern {
                background-size: calc(var(--width) * 0.6) calc(var(--height) * 0.6);
                width: calc(var(--width) * 0.6);
                height: calc(var(--height) * 0.6);
                top: -45px;
            }

            .small .lantern.left {
                left: 45px;
            }

            .small .lantern.right {
                left: 515px;
            }

            .big .lantern.right {
                left: 600px;
                top: 0;
            }

            .image {
                --width: <%= assets.image.width %>px;
                --height: <%= assets.image.height %>px;
                background-image: url('<%= assets.image.src %>');
                background-size: calc(50px + var(--width)) calc(var(--height) * 0.9);
                background-repeat: no-repeat;
                width: calc(50px + var(--width));
                height: var(--height);
                position: absolute;
                top: 30px;
                left: 60px;
            }

            .text {
                position: relative;
                height: 100%;
                width: 100%;
                color: #eaeaea;
                /* background: pink; */
            }

            div.slide.light .text {
                color: #1d1d1d;
                /* background: pink; */
            }

            .text .arabic {
                display: flex;
                justify-content: center;
                align-items: center;
                text-align: center;

                font-family: 'me-quran';
                word-spacing: 10;
                word-wrap: break-word;
                overflow-wrap: break-word;
                padding: 10px;
                /* font-weight: 500; */

                position: absolute;
                width: 1200px;
                height: 600px;
                right: 5px;
                top: 2px;

                /* background-color: yellow; */
            }

            .verseNumber {
                font-family: 'me-quran';
                /* white-space: nowrap; */
            }

            .text .german {
                display: flex;
                justify-content: center;
                align-items: center;
                text-align: center;

                font-family: 'Helvetica';
                word-spacing: 5;
                word-wrap: break-word;
                overflow-wrap: break-word;
                padding: 10px;
                font-weight: 600;

                position: absolute;
                height: 400px;
                width: 100%;
                bottom: 72px;
                left: 0;

                /* background-color: red; */
            }

            p {
                margin: 0;
            }

            @media print {
                .slide {
                    page-break-before: always;
                }
            }
        </style>
        <script>
            String.prototype.toArabicDigits= function(){
                var id= ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
                return this.replace(/[0-9]/g, function(w){
                    return id[+w]
                });
            }
        </script>
    </head>
    <body>
    <% if( content !== undefined ) { %>
        <% content.slides.forEach((slide) => { %>
            <script>
                var slideNumber = '<%= slide.number %>'.toArabicDigits();
            </script>
            <div class="slide">
                <div class="lanterns">
                    <div class="small">
                        <div class="lantern left"></div>
                        <div class="lantern right"></div>
                    </div>
                    <div class="big">
                        <div class="lantern right"></div>
                    </div>
                </div>
                <div class="text">
                    <div class="title">
                        <p><%= content.title %></p>
                    </div>
                    <div class="arabic" dir="rtl">
                        <p><%= slide.arabic %> ﴿<script>document.write(slideNumber)</script>﴾</p>
                        <!-- <p><%= slide.arabic %> (<%= slide.number %>)</p> -->
                    </div>
                    <div class="german" dir="ltr">
                        <!-- <p><%= slide.german %> <span class="verseNumber">(<%= slide.number %>)</span></p> -->
                        <p><%= slide.german %> (<%= slide.number %>)</p>
                    </div>
                </div>
                <div class="ribbon"></div>
            </div>
        <% }); %>
    <% } %>
    <script>
        const titleTexts = document.getElementsByClassName("title");
        const arabicTexts = document.getElementsByClassName("arabic");
        const germanTexts = document.getElementsByClassName("german");

        const resizeText = (childDiv, maxSize) => {
            const paragraph = childDiv.querySelector("p");
            const maxWidth = childDiv.clientWidth;
            const maxHeight = childDiv.clientHeight;

            let fontSize = 15;
            paragraph.style.fontSize = `${fontSize}px`;

            while (paragraph.clientWidth < maxWidth && paragraph.clientHeight < maxHeight) {
                fontSize++;
                paragraph.style.fontSize = `${fontSize}px`;
            }

            // Decrease the font size by 1 to ensure it fits within the child div
            fontSize--;

            if ( fontSize > maxSize ) {
                fontSize = maxSize;
            }

            paragraph.style.fontSize = `${fontSize}px`;
            // paragraph.style.lineHeight = `${fontSize * 2}px`;
        }

        const setFontSize = (elem, maxSize) => {
            const stringLength = elem.innerText.length;
            console.log("String length: ", stringLength);

            const newSize = (maxSize - (stringLength / 100) * 0.2);
            elem.style.fontSize = newSize + "rem";
            elem.style.lineHeight = (newSize * 2) + "rem";
            return;
        }

        for (const elem of titleTexts) {
            resizeText(elem, 50);
        }
        for (const elem of arabicTexts) {
            resizeText(elem, 80);
        }
        for (const elem of germanTexts) {
            resizeText(elem, 50);
        }
        
    </script>
    </body>
</html>
